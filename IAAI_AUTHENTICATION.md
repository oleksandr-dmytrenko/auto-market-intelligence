# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è IAAI Scraper

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ IAAI.com –¥–ª—è —Å–∫—Ä–∞–ø–µ—Ä–∞.

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ª–æ–≥–∏–Ω** –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Å–∫—Ä–∞–ø–∏–Ω–≥–∞
2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ cookies** –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ cookies –≤ cloudscraper** –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ Incapsula challenge** –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–æ–≥–∏–Ω–∞
5. **–ò–º–∏—Ç–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è** –ø—Ä–∏ –≤–≤–æ–¥–µ –¥–∞–Ω–Ω—ã—Ö

## üîê –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
IAAI_EMAIL=zender.dmitrenko@gmail.com
IAAI_PASSWORD=$+Z@Cm2+97#af4u
```

–ò–ª–∏ –≤ `docker-compose.yml`:

```yaml
environment:
  IAAI_EMAIL: ${IAAI_EMAIL:-zender.dmitrenko@gmail.com}
  IAAI_PASSWORD: ${IAAI_PASSWORD:-$+Z@Cm2+97#af4u}
```

**–í–∞–∂–Ω–æ**: –ü–∞—Ä–æ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –≤ –≤–∞—à–µ–π —Å—Ä–µ–¥–µ.

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

1. **–û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ª–æ–≥–∏–Ω–∞**
   - URL: `https://www.iaai.com/Login`
   - –û–∂–∏–¥–∞–Ω–∏–µ –æ–±—Ö–æ–¥–∞ Incapsula challenge

2. **–ü–æ–∏—Å–∫ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã**
   - Email –ø–æ–ª–µ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã)
   - Password –ø–æ–ª–µ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã)
   - Submit –∫–Ω–æ–ø–∫–∞ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã)

3. **–í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö**
   - –ò–º–∏—Ç–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–≤–æ–¥–∞
   - –°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É —Å–∏–º–≤–æ–ª–∞–º–∏

4. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã**
   - –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É –∏–ª–∏ –Ω–∞–∂–∞—Ç–∏–µ Enter

5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ URL (dashboard, account, profile)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ "logout", "sign out"
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ cookies

6. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ cookies**
   - Cookies –∏–∑ Selenium —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ cloudscraper session
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –°–µ–ª–µ–∫—Ç–æ—Ä—ã —Ñ–æ—Ä–º—ã:

–°–∫—Ä–∞–ø–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏:

**Email –ø–æ–ª–µ:**
- `input[type="email"]`
- `input[name="email"]`
- `input[id*="email"]`
- `input[placeholder*="email"]`

**Password –ø–æ–ª–µ:**
- `input[type="password"]`
- `input[name="password"]`
- `input[id*="password"]`

**Submit –∫–Ω–æ–ø–∫–∞:**
- `button[type="submit"]`
- `input[type="submit"]`
- –ö–Ω–æ–ø–∫–∏ —Å —Ç–µ–∫—Å—Ç–æ–º "Sign In", "Login", "Log In"

## üìã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ `scrape_listings()`:

```python
from workers.iaai_scraper import IAAIScraper
from workers.rate_limiter import RateLimiter
import redis

redis_client = redis.from_url('redis://localhost:6379/0')
rate_limiter = RateLimiter(redis_client)
fetcher = AuctionFetcher(rate_limiter)

# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
vehicles = fetcher.fetch_iaai_listings({'make': 'Toyota', 'model': 'Camry'}, limit=10)
```

### –†—É—á–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:

```python
scraper = IAAIScraper(driver, rate_limiter)
if scraper._authenticate():
    print("–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞")
    vehicles = scraper.scrape_listings('Toyota', 'Camry', limit=10)
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Selenium –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Selenium, —Ç–∞–∫ –∫–∞–∫ —Ç—Ä–µ–±—É–µ—Ç JavaScript –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ä–º—ã.

2. **Incapsula challenge**: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ —Ç–∞–∫–∂–µ –∑–∞—â–∏—â–µ–Ω–∞ Incapsula, –ø–æ—ç—Ç–æ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è (–¥–æ 60 —Å–µ–∫—É–Ω–¥).

3. **Cookies**: –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ cookies —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ cloudscraper –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –∏—Ö –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

5. **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã**: –ü–∞—Ä–æ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (`$+Z@Cm2+97#af4u`). –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –≤ –≤–∞—à–µ–π —Å—Ä–µ–¥–µ.

## üîç –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**: –°–∫—Ä–∞–ø–µ—Ä –≤—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–æ—Ä–º—ã IAAI –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Incapsula**: Challenge –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ email –∏ –ø–∞—Ä–æ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤:

```
Authenticating as zender.dmitrenko@gmail.com...
Opening login page: https://www.iaai.com/Login
‚ö† Waiting for Incapsula challenge to pass...
‚úì Challenge passed after 15 seconds
‚úì Found email field using By.ID: email
‚úì Found password field using By.NAME: password
Entering credentials...
‚úì Found submit button using By.CSS_SELECTOR: button[type='submit']
Waiting for login to complete...
‚úì Authentication successful!
‚úì Saved 12 cookies to cloudscraper session
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–æ—Ä–º—ã –ª–æ–≥–∏–Ω–∞ IAAI –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –≤ –º–µ—Ç–æ–¥–µ `_authenticate()`.

