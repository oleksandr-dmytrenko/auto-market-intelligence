# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞ bidly.tech

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –¥–æ–º–µ–Ω–∞ `bidly.tech` –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –í–∞–∂–Ω–æ: HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

Telegram Mini App **—Ç—Ä–µ–±—É–µ—Ç HTTPS** –¥–ª—è —Ä–∞–±–æ—Ç—ã. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –∞–∫—Ç–∏–≤–µ–Ω
- –î–æ–º–µ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `https://bidly.tech`, –∞ –Ω–µ `http://bidly.tech`

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ A-–∑–∞–ø–∏—Å–∏

–í –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–Ω–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–æ–∑–¥–∞–π—Ç–µ A-–∑–∞–ø–∏—Å—å:

```
–¢–∏–ø: A
–ò–º—è: @ (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞)
–ó–Ω–∞—á–µ–Ω–∏–µ: IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ VPS
TTL: 3600 (–∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–¥–æ–º–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥–¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `app.bidly.tech`):

```
–¢–∏–ø: A
–ò–º—è: app
–ó–Ω–∞—á–µ–Ω–∏–µ: IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ VPS
TTL: 3600
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Hestia CP / aaPanel

1. –í –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: **Web** ‚Üí **Add Web Domain**
2. –£–∫–∞–∂–∏—Ç–µ –¥–æ–º–µ–Ω: `bidly.tech`
3. –í–∫–ª—é—á–∏—Ç–µ SSL: **SSL** ‚Üí **Let's Encrypt** ‚Üí **Apply**
4. –í–∫–ª—é—á–∏—Ç–µ **Force HTTPS** (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ HTTPS)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Kamal (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

Kamal –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —á–µ—Ä–µ–∑ Let's Encrypt –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–µ–ø–ª–æ–µ:

```bash
cd rails_api
kamal setup
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `config/deploy.yml` —É–∫–∞–∑–∞–Ω–æ:

```yaml
proxy:
  ssl: true
  host: bidly.tech
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Certbot

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ certbot
apt-get update
apt-get install certbot

# –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
certbot certonly --standalone -d bidly.tech -d www.bidly.tech

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
certbot renew --dry-run
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Reverse Proxy

### –î–ª—è Hestia CP / aaPanel

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ Rails API:

```nginx
location / {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

location /mini-app {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

### –î–ª—è Kamal (–±–µ–∑ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

Kamal –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç Traefik –∫–∞–∫ reverse proxy.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
# –í GitHub Secrets
DEPLOY_DOMAIN=bidly.tech
MINI_APP_URL=https://bidly.tech/mini-app

# –í .kamal/secrets –∏–ª–∏ .env
DEPLOY_DOMAIN=bidly.tech
MINI_APP_URL=https://bidly.tech/mini-app
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ A-–∑–∞–ø–∏—Å–∏
dig bidly.tech
nslookup bidly.tech

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å IP –≤–∞—à–µ–≥–æ VPS
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
curl -I https://bidly.tech/up

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
# –û—Ç–∫—Ä–æ–π—Ç–µ https://bidly.tech –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–µ–ª–µ–Ω—ã–π –∑–∞–º–æ—á–µ–∫ üîí
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Mini App

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Mini App
curl https://bidly.tech/mini-app

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram –±–æ—Ç–∞

–í Telegram –±–æ—Ç–µ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å Mini App —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –º–µ–Ω—é. –î–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

## Troubleshooting

### –î–æ–º–µ–Ω –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏: `dig bidly.tech`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ A-–∑–∞–ø–∏—Å—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 48 —á–∞—Å–æ–≤, –æ–±—ã—á–Ω–æ 5-15 –º–∏–Ω—É—Ç)

### SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã –≤ firewall
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `certbot certificates`

### Mini App –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ Telegram

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **HTTPS**, –∞ –Ω–µ HTTP
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `MINI_APP_URL` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Rails API: `kamal app logs`

### 502 Bad Gateway

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Rails API –∑–∞–ø—É—â–µ–Ω: `kamal app logs`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç (3000)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞ –≤ –∫–æ–¥–µ

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–æ–º–µ–Ω, –æ–±–Ω–æ–≤–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:

1. `rails_api/config/deploy.yml` - `proxy.host`
2. `docker-compose.yml` - `MINI_APP_URL`
3. `docker-compose.prod.yml` - `MINI_APP_URL`
4. GitHub Secrets - `DEPLOY_DOMAIN` –∏ `MINI_APP_URL`
5. `.env` —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSL

### –ß–µ—Ä–µ–∑ Hestia CP / aaPanel

–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt.

### –ß–µ—Ä–µ–∑ Cron (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ certbot –Ω–∞–ø—Ä—è–º—É—é)

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab
0 0 * * * certbot renew --quiet && systemctl reload nginx
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–∞:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å: `https://bidly.tech/up`
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Mini App: `https://bidly.tech/mini-app`
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ Telegram –±–æ—Ç–∞
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±—ç–∫–∞–ø—ã

